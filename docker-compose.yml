services:
  app:
    build: .
    container_name: meshrf
    ports:
      - "5173:5173"
    environment:
    # Hostname for reverse proxy
      - ALLOWED_HOSTS=localhost
    # Custom Elevation API Endpoint (Optional)
    # - VITE_ELEVATION_API_URL=http://localhost:8080/v1/elevation
    # Default Map Center (Portland, OR)
      - VITE_MAP_LAT=45.5152
      - VITE_MAP_LNG=-122.6784
    volumes:
      - .:/app
      - /app/node_modules
    command: npm run dev -- --host

  rf-engine:
    build: ./rf-engine
    container_name: rf_engine
    ports:
      - "5001:5001"
    environment:
      # Elevation Data Configuration
      # For custom OpenTopoData instance (e.g., self-hosted with local SRTM data)
      # Leave blank to use public api.opentopodata.org (1000 requests/day limit)
      - ELEVATION_API_URL=${ELEVATION_API_URL:-https://api.opentopodata.org}
      
      # Dataset to use: srtm30m, srtm90m, aster30m, ned10m, etc.
      # See: https://www.opentopodata.org/datasets/
      - ELEVATION_DATASET=${ELEVATION_DATASET:-srtm30m}
    volumes:
      - ./cache:/app/cache

    restart: unless-stopped
    depends_on:
      - redis

  rf-worker:
    build: ./rf-engine
    container_name: rf_worker
    command: celery -A tasks worker --loglevel=info
    volumes:
      - ./cache:/app/cache

    restart: unless-stopped
    depends_on:
      - redis
      - rf-engine

  redis:
    image: redis:alpine
    user: root
    ports:
      - "6379:6379"
    volumes:
      - ./redis_data:/data
    restart: always
